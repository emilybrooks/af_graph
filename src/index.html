<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Animal Forest Decompilation</title>

<link rel="stylesheet" href="dist/uPlot.min.css">
<style>
    .uplot {
        display: inline-block;
    }
</style>
</head>
<body>
<script src="dist/uPlot.iife.js"></script>

<p id="progressAll"></p>
<p id="progressBoot"></p>
<p id="progressCode"></p>
<p id="progressOverlays"></p>

<script>
    function percentValue(self, rawValue) {
        if (rawValue == null) {
            return null;
        }
        return rawValue.toFixed(2) + "%";
    }

    let opts =
    {
        title: "Animal Forest Code Decompilation Progress",
        width: 800,
        height: 400,
        series:
        [
            {},
            {
                label: "Code Decompiled",
                width: 2,
                stroke: "rgb(255, 99, 132)",
                value: percentValue,
            }
        ],
        axes:
        [
            {},
            {
                values: (self, ticks) => ticks.map(rawValue => rawValue.toFixed(0) + "%"),
            },
        ],
    };


    let u = new uPlot(opts, null, document.body);

    fetch('https://progress.deco.mp/data/animalforest/jp/?mode=all')
    .then(v => v.json())
    .then(result =>
    {
        const currentProgress = result['animalforest']['jp']['code'][0];
        document.getElementById("progressAll").innerHTML = (100 * currentProgress['measures']['all'] / currentProgress['measures']['all/total']).toFixed(2) + "%";
        document.getElementById("progressBoot").innerHTML = (100 * currentProgress['measures']['boot'] / currentProgress['measures']['boot/total']).toFixed(2) + "%";
        document.getElementById("progressCode").innerHTML = (100 * currentProgress['measures']['code'] / currentProgress['measures']['code/total']).toFixed(2) + "%";
        document.getElementById("progressOverlays").innerHTML = (100 * currentProgress['measures']['overlays'] / currentProgress['measures']['overlays/total']).toFixed(2) + "%";

        const entries = result['animalforest']['jp']['code'].reverse();
        u.setData([
            entries.map(a => a.timestamp),
            entries.map(a => 100 * (a.measures['all'] / a.measures['all/total'])),
        ]);

        
    });

</script>
</body>
</html>