<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Animal Forest Decompilation</title>

<link rel="stylesheet" href="dist/uPlot.min.css">
<style>
    .uplot {
        display: inline-block;
    }
</style>
</head>
<body>
<script src="dist/uPlot.iife.js"></script>

<p id="lastUpdated"></p>
<table>
<tr>
    <td>Total</td>
    <td id="progressTotal"></td>
</tr>
<tr>
    <td>Boot</td>
    <td id="progressBoot"></td>
</tr>
<tr>
    <td>Code</td>
    <td id="progressCode"></td>
</tr>
<tr>
    <td>Overlays</td>
    <td id="progressOverlays"></td>
</tr>
</table>
<!-- <p ></p>
<p id="progressBoot"></p>
<p id="progressCode"></p>
<p id="progressOverlays"></p> -->

<script>
    function percentValue(self, rawValue) {
        if (rawValue == null) {
            return null;
        }
        return rawValue.toFixed(2) + "%";
    }

    let opts =
    {
        title: "Animal Forest Code Decompilation Progress",
        width: 800,
        height: 400,
        series:
        [
            {},
            {
                label: "Total",
                width: 2,
                stroke: "rgb(255, 99, 132)",
                value: percentValue,
            },
        ],
        axes:
        [
            {},
            {
                values: (self, ticks) => ticks.map(rawValue => rawValue.toFixed(0) + "%"),
            },
        ],
    };

    let u = new uPlot(opts, null, document.body);

    fetch('https://progress.deco.mp/data/animalforest/jp/?mode=all')
    .then(v => v.json())
    .then(result =>
    {
        const lastUpdated = result['animalforest']['jp']['code'][0]['timestamp'];
        document.getElementById("lastUpdated").innerHTML = "Last updated: " + new Date(lastUpdated * 1000).toLocaleString();

        const currentProgress = result['animalforest']['jp']['code'][0]['measures'];
        document.getElementById("progressTotal").innerHTML = (100 * currentProgress['all'] / currentProgress['all/total']).toFixed(2) + "%";
        document.getElementById("progressBoot").innerHTML = (100 * currentProgress['boot'] / currentProgress['boot/total']).toFixed(2) + "%";
        document.getElementById("progressCode").innerHTML = (100 * currentProgress['code'] / currentProgress['code/total']).toFixed(2) + "%";
        document.getElementById("progressOverlays").innerHTML = (100 * currentProgress['overlays'] / currentProgress['overlays/total']).toFixed(2) + "%";

        const entries = result['animalforest']['jp']['code'].reverse();
        u.setData([
            entries.map(a => a.timestamp),
            entries.map(a => 100 * (a.measures['all'] / a.measures['all/total'])),
        ]);

        
    });

</script>
</body>
</html>